# Copyright (c) 2026-2026 by the parties listed in the AUTHORS file.
# All rights reserved.  Use of this source code is governed by
# a BSD-style license that can be found in the LICENSE file.

import argparse
import os

# We use absolute imports to find the location of the installed
# package.
import flacarray


def cli():
    parser = argparse.ArgumentParser(description="Print configuration of flacarray")
    parser.add_argument(
        "--version",
        required=False,
        default=False,
        action="store_true",
        help="Print the package version",
    )
    parser.add_argument(
        "--package",
        required=False,
        default=False,
        action="store_true",
        help="Print the package install location",
    )
    parser.add_argument(
        "--static",
        required=False,
        default=False,
        action="store_true",
        help="Print the values for static linking instead of dynamic",
    )
    parser.add_argument(
        "--cflags",
        required=False,
        default=False,
        action="store_true",
        help="Print the include CFLAGS (-I...)",
    )
    parser.add_argument(
        "--include",
        required=False,
        default=False,
        action="store_true",
        help="Print the directory containing flacarray.h",
    )
    parser.add_argument(
        "--libdir",
        required=False,
        default=False,
        action="store_true",
        help="Print the directory containing libflacarray",
    )
    parser.add_argument(
        "--ldflags",
        required=False,
        default=False,
        action="store_true",
        help="Print the linking LDFLAGS (-L...)",
    )
    parser.add_argument(
        "--libs",
        required=False,
        default=False,
        action="store_true",
        help="Print the linking libraries (-lflacarray)",
    )
    parser.add_argument(
        "--libraries",
        required=False,
        default=False,
        action="store_true",
        help="Print the full library paths",
    )

    args = parser.parse_args()

    version = flacarray.__version__
    pkg_root = os.path.dirname(flacarray.__file__)
    pkg_incdir = f"{pkg_root}/include"
    pkg_libdir = f"{pkg_root}/lib"

    shared_suffix = "@CMAKE_SHARED_LIBRARY_SUFFIX@"
    static_suffix = "@CMAKE_STATIC_LIBRARY_SUFFIX@"

    # First process options that should be used in isolation.
    if args.version:
        print(version)
    elif args.package:
        print(pkg_root)
    elif args.include:
        print(pkg_incdir)
    elif args.libdir:
        print(pkg_libdir)
    elif args.libraries:
        # Print full library paths
        if args.static:
            libpath = os.path.join(pkg_libdir, f"libflacarray{static_suffix}")
        else:
            libpath = os.path.join(pkg_libdir, f"libflacarray{shared_suffix}")
        print(f"{libpath};@CONF_EXTRA_LINK@")
    else:
        # These options can be combined
        output = ""
        if args.cflags:
            output = f"{output} -I{pkg_incdir}"
        if args.ldflags:
            output = f"{output} -L{pkg_libdir}"
        if args.libs:
            if args.static:
                output = f"{output} -lflacarray_static"
            else:
                output = f"{output} -lflacarray"
        if output != "":
            print(output)
        else:
            parser.print_help()


if __name__ == "__main__":
    cli()
